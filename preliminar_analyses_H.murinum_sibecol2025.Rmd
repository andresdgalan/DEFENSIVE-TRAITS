---
title: "DEFENSIVE TRAITS H.murinum SIBECOL 2025"
author: "Andrés Delgado Galán"
date: "2025-05-18"
output:
  html_document: default
  pdf_document: default
---

```{r LOADING DATA AND PACKAGES, include=FALSE}

library(dplyr)
library(DHARMa)
library(ggplot2)
library(ggeffects)
library(cowplot)
library(kableExtra)
library(tibble)
library(knitr)
library(emmeans)
library(car)
library(scales)

data <- read.table("rawdata/datos_sibecol_2025.csv", header = TRUE, sep = ";")
datamother <- read.table("rawdata/seedmother.csv", header = TRUE, sep = ";")
```

```{r PRE-ANALYSIS Data PREPARATION, include=FALSE}
#hacemos una matriz para para la especie HO
HOdata <- data |> filter(sp == "HO")
```

```{r PREPARING A PLOTTING FUNCTION, include=FALSE}
# Define color palettes
custom_colors <- c("Grazed" = "#FF10F0", "Ungrazed" = "#006400")
lighter_colors <- c("Grazed" = alpha("#FF10F0", 0.3), "Ungrazed" = alpha("#006400", 0.3))

# Named vectors for relabeling
trat_labels <- c("gra" = "Grazed", "ex" = "Ungrazed")
clip_labels <- c("yes" = "Damaged", "no" = "Undamaged")

# Prepare your data once
HOdata <- HOdata %>%
  mutate(
    trat_label = factor(trat_labels[as.character(trat)], levels = c("Ungrazed", "Grazed")),
    clip_label = factor(clip_labels[as.character(clip)], levels = c("Undamaged", "Damaged"))
  )

# Define a reusable plotting function
plot_HO_variable <- function(data, response_var) {
  ggplot(data, aes(x = trat_label, y = {{ response_var }})) +
    
    # Boxplot
    geom_boxplot(
      aes(color = trat_label),
      fill = NA,
      size = 1,
      width = 0.5
    ) +
    
    # Violin for Undamaged (filled)
    geom_violin(
      data = filter(data, clip_label == "Undamaged"),
      aes(
        fill = trat_label,
        group = interaction(trat_label, clip_label),
        linetype = clip_label
      ),
      color = NA,
      alpha = 0.2,
      width = 0.5,
      scale = "area"
    ) +
    
    # Violin for Damaged (outline)
    geom_violin(
      data = filter(data, clip_label == "Damaged"),
      aes(
        color = trat_label,
        group = interaction(trat_label, clip_label),
        linetype = clip_label
      ),
      fill = NA,
      alpha = 0.2,
      size = 0.8,
      width = 0.5,
      scale = "area"
    ) +
    
    scale_color_manual(values = custom_colors, guide = "none") +
    scale_fill_manual(values = custom_colors, guide = "none") +
    scale_linetype_manual(
      values = c("Undamaged" = "solid", "Damaged" = "dashed"),
      name = NULL
    ) +
    
    labs(
      x = "Maternal Environment",
      y = as_label(enquo(response_var)),
      linetype = "Herbivory Simulation"
    ) +
    theme_minimal() +
    theme(
      legend.title = element_blank(),
      legend.position = "right"
    )
}

```

### H.murinum - PRODUCCIÓN DE FLORES

```{r HOflor Model, include=FALSE}
#filtramos las filas con datos de nº de flores
HOdata.flor <- subset(HOdata, !is.na(flor))
HOdata.flor$flor
# AS THERE ARE MANY 0s, WE WILL REMOVE 0s also
HOdata.flor <- subset(HOdata.flor, flor != 0)

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOflormodel <- lm(log(flor) ~ trat + clip + trat:clip, data = HOdata.flor, na.action = na.fail)

sample_size <- nrow(HOdata.flor)
sample_size
# Extract the formula from the model
model_formula <- formula(HOflormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`** (40 0s were removed)

```{r DHARMA HOflor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOflormodel)
plot(residuals)
```

```{r SUMMARY OF HOflor MODEL, include=FALSE}
summary <- summary(HOflormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOflor MODEL, include=FALSE}
anova_flor <- Anova(HOflormodel, type = 2, test.statistic = "F")
anova_flor
```

```{r HOflor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOflormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOflormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOflor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOflor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOflor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_flor %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO flor"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOflor Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata.flor, flor)

```

### H.murinum - PRODUCCIÓN DE FRUTOS

```{r HOfruto Model, include=FALSE}
#filtramos las filas con datos de nº de frutoes
HOdata.fruto <- subset(HOdata, !is.na(fruto))
HOdata.fruto$fruto
# AS THERE ARE MANY 0s, WE WILL REMOVE 0s also
HOdata.fruto <- subset(HOdata.fruto, fruto != 0)

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOfrutomodel <- lm(sqrt(fruto) ~ trat + clip + trat:clip, data = HOdata.fruto, na.action = na.fail)

sample_size <- nrow(HOdata.fruto)
sample_size
# Extract the formula from the model
model_formula <- formula(HOfrutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`** (43 0s removed)

```{r DHARMA HOfruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOfrutomodel)
plot(residuals)
```

```{r SUMMARY OF HOfruto MODEL, include=FALSE}
summary <- summary(HOfrutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOfruto MODEL, include=FALSE}
anova_fruto <- Anova(HOfrutomodel, type = 2, test.statistic = "F")
anova_fruto
```

```{r HOfruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOfrutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOfrutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOfruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_fruto %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO fruto"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOfruto Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata.fruto, fruto)

```

### H.murinum - PRODUCCIÓN DE HOJAS

```{r HOhojas Model, include=FALSE}
#filtramos las filas con datos de nº de hojases
HOdata.hojas <- subset(HOdata, !is.na(hojas))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOhojasmodel <- lm(sqrt(hojas) ~ trat + clip + trat:clip, data = HOdata.hojas, na.action = na.fail)

sample_size <- nrow(HOdata.hojas)
sample_size
# Extract the formula from the model
model_formula <- formula(HOhojasmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOhojas: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOhojasmodel)
plot(residuals)
```

```{r SUMMARY OF HOhojas MODEL, include=FALSE}
summary <- summary(HOhojasmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOhojas MODEL, include=FALSE}
anova_hojas <- Anova(HOhojasmodel, type = 2, test.statistic = "F")
anova_hojas
```

```{r HOhojas Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOhojasmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOhojasmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOhojas Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOhojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOhojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_hojas %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO hojas"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOhojas Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO hojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, hojas)
```

### H.murinum - ALTURA MÁXIMA

```{r HOaltura Model, include=FALSE}
#filtramos las filas con datos de nº de alturaes
HOdata.altura <- subset(HOdata, !is.na(altura))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOalturamodel <- lm(sqrt(altura) ~ trat + clip + trat:clip, data = HOdata.altura, na.action = na.fail)

sample_size <- nrow(HOdata.altura)
sample_size
# Extract the formula from the model
model_formula <- formula(HOalturamodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOaltura: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOalturamodel)
plot(residuals)
```

```{r SUMMARY OF HOaltura MODEL, include=FALSE}
summary <- summary(HOalturamodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOaltura MODEL, include=FALSE}
anova_altura <- Anova(HOalturamodel, type = 2, test.statistic = "F")
anova_altura
```

```{r HOaltura Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOalturamodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOalturamodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOaltura Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOaltura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOaltura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_altura %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO altura"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOaltura Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO altura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, altura)


```

### H.murinum - SEMILLAS/FRUTO

```{r HOseedfruto Model, include=FALSE}
#filtramos las filas con datos de nº de seedfrutoes
HOdata.seedfruto <- subset(HOdata, !is.na(seedfruto))
HOdata.seedfruto$seedfruto

subset(HOdata.seedfruto, trat == "gra" & clip == "yes")$seedfruto
subset(HOdata.seedfruto, trat == "gra" & clip == "no")$seedfruto
subset(HOdata.seedfruto, trat == "ex" & clip == "no")$seedfruto
subset(HOdata.seedfruto, trat == "ex" & clip == "yes")$seedfruto

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOseedfrutomodel <- lm(sqrt(seedfruto) ~ trat + clip + trat:clip, data = HOdata.seedfruto, na.action = na.fail)

sample_size <- nrow(HOdata.seedfruto)
# Extract the formula from the model
model_formula <- formula(HOseedfrutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`** (los resultados del ANOVA no tienen sentido porque algunos tratamientos solo tienen 1 o 2 réplicas)

```{r DHARMA HOseedfruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOseedfrutomodel)
plot(residuals)
```

```{r SUMMARY OF HOseedfruto MODEL, include=FALSE}
summary <- summary(HOseedfrutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOseedfruto MODEL, include=FALSE}
anova_seedfruto <- Anova(HOseedfrutomodel, type = 2, test.statistic = "F")
anova_seedfruto
```

```{r HOseedfruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOseedfrutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOseedfrutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOseedfruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOseedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOseedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_seedfruto %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO seedfruto"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOseedfruto Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO seedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, seedfruto)

```

### H.murinum - PRODUCCIÓN DE SEMILLAS

```{r HOseedtotal Model, include=FALSE}
#filtramos las filas con datos de nº de seedtotales
HOdata.seedtotal <- subset(HOdata, !is.na(seedtotal))
hist(HOdata.seedtotal$seedtotal)
# AS THERE ARE MANY 0s, WE WILL REMOVE 0s also
HOdata.seedtotal <- subset(HOdata.seedtotal, seedtotal != 0)

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOseedtotalmodel <- lm(sqrt(seedtotal) ~ trat + clip + trat:clip, data = HOdata.seedtotal, na.action = na.fail)

sample_size <- nrow(HOdata.seedtotal)
sample_size
# Extract the formula from the model
model_formula <- formula(HOseedtotalmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`** (43 0s removed)

```{r DHARMA HOseedtotal: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOseedtotalmodel)
plot(residuals)
```

```{r SUMMARY OF HOseedtotal MODEL, include=FALSE}
summary <- summary(HOseedtotalmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOseedtotal MODEL, include=FALSE}
anova_seedtotal <- Anova(HOseedtotalmodel, type = 2, test.statistic = "F")
anova_seedtotal
```

```{r HOseedtotal Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOseedtotalmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOseedtotalmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOseedtotal Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOseedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOseedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_seedtotal %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO seedtotal"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOseedtotal Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO seedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata.seedtotal, seedtotal)

```

### H.murinum - PESO MEDIO DE LAS SEMILLAS

```{r HOmassseed Model, include=FALSE}
#filtramos las filas con datos de nº de massseedes
HOdata.massseed <- subset(HOdata, !is.na(massseed))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOmassseedmodel <- lm(sqrt(massseed) ~ trat + clip + trat:clip, data = HOdata.massseed, na.action = na.fail)

sample_size <- nrow(HOdata.massseed)
sample_size
# Extract the formula from the model
model_formula <- formula(HOmassseedmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOmassseed: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOmassseedmodel)
plot(residuals)
```

```{r SUMMARY OF HOmassseed MODEL, include=FALSE}
summary <- summary(HOmassseedmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOmassseed MODEL, include=FALSE}
anova_massseed <- Anova(HOmassseedmodel, type = 2, test.statistic = "F")
anova_massseed
```

```{r HOmassseed Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOmassseedmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOmassseedmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOmassseed Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOmassseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOmassseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_massseed %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO massseed"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOmassseed Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO massseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, massseed)
```

### H.murinum - SLA

```{r HOSLA Model, include=FALSE}
#filtramos las filas con datos de nº de SLAes
HOdata.SLA <- subset(HOdata, !is.na(SLA))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOSLAmodel <- lm(sqrt(SLA) ~ trat + clip + trat:clip, data = HOdata.SLA, na.action = na.fail)

sample_size <- nrow(HOdata.SLA)
# Extract the formula from the model
model_formula <- formula(HOSLAmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOSLA: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOSLAmodel)
plot(residuals)
```

```{r SUMMARY OF HOSLA MODEL, include=FALSE}
summary <- summary(HOSLAmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOSLA MODEL, include=FALSE}
anova_SLA <- Anova(HOSLAmodel, type = 2, test.statistic = "F")
anova_SLA
```

```{r HOSLA Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOSLAmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOSLAmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOSLA Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOSLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOSLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_SLA %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO SLA"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOSLA Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO SLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, SLA)

```

### H.murinum - LDMC

```{r HOLDMC Model, include=FALSE}
#filtramos las filas con datos de nº de LDMCes
HOdata.LDMC <- subset(HOdata, !is.na(LDMC))



#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOLDMCmodel <- lm(sqrt(LDMC) ~ trat + clip + trat:clip, data = HOdata.LDMC, na.action = na.fail)

sample_size <- nrow(HOdata.LDMC)
# Extract the formula from the model
model_formula <- formula(HOLDMCmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOLDMC: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOLDMCmodel)
plot(residuals)
```

```{r SUMMARY OF HOLDMC MODEL, include=FALSE}
summary <- summary(HOLDMCmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOLDMC MODEL, include=FALSE}
anova_LDMC <- Anova(HOLDMCmodel, type = 2, test.statistic = "F")
anova_LDMC
```

```{r HOLDMC Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOLDMCmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOLDMCmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOLDMC Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOLDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOLDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_LDMC %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO LDMC"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOLDMC Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO LDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, LDMC)
```

### H.murinum - ÁREA FOLIAR

```{r HOarea.m Model, include=FALSE}
#filtramos las filas con datos de nº de area.mes
HOdata.area.m <- subset(HOdata, !is.na(area.m))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOarea.mmodel <- lm(sqrt(area.m) ~ trat + clip + trat:clip, data = HOdata.area.m, na.action = na.fail)

sample_size <- nrow(HOdata.area.m)
# Extract the formula from the model
model_formula <- formula(HOarea.mmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOarea.m: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOarea.mmodel)
plot(residuals)
```

```{r SUMMARY OF HOarea.m MODEL, include=FALSE}
summary <- summary(HOarea.mmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOarea.m MODEL, include=FALSE}
anova_area.m <- Anova(HOarea.mmodel, type = 2, test.statistic = "F")
anova_area.m
```

```{r HOarea.m Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOarea.mmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOarea.mmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOarea.m Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOarea.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOarea.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_area.m %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO area.m"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOarea.m Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO area.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, area.m)
```

### H.murinum - TASA FOTOSINTÉTICA

```{r HOPhotosyn Model, include=FALSE}
#filtramos las filas con datos de nº de Photosynes
HOdata.Photosyn <- subset(HOdata, !is.na(Photosyn))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOPhotosynmodel <- lm(sqrt(Photosyn) ~ trat + clip + trat:clip, data = HOdata.Photosyn, na.action = na.fail)

sample_size <- nrow(HOdata.Photosyn)
# Extract the formula from the model
model_formula <- formula(HOPhotosynmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOPhotosyn: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOPhotosynmodel)
plot(residuals)
```

```{r SUMMARY OF HOPhotosyn MODEL, include=FALSE}
summary <- summary(HOPhotosynmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOPhotosyn MODEL, include=FALSE}
anova_Photosyn <- Anova(HOPhotosynmodel, type = 2, test.statistic = "F")
anova_Photosyn
```

```{r HOPhotosyn Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOPhotosynmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOPhotosynmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOPhotosyn Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOPhotosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOPhotosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_Photosyn %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO Photosyn"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOPhotosyn Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO Photosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, Photosyn)

```

### H.murinum - CONDUCTANCIA ESTOMÁTICA

```{r HOConductance Model, include=FALSE}
#filtramos las filas con datos de nº de Conductancees
HOdata.Conductance <- subset(HOdata, !is.na(Conductance))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOConductancemodel <- lm(sqrt(Conductance) ~ trat + clip + trat:clip, data = HOdata.Conductance, na.action = na.fail)

sample_size <- nrow(HOdata.Conductance)
# Extract the formula from the model
model_formula <- formula(HOConductancemodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOConductance: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOConductancemodel)
plot(residuals)
```

```{r SUMMARY OF HOConductance MODEL, include=FALSE}
summary <- summary(HOConductancemodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOConductance MODEL, include=FALSE}
anova_Conductance <- Anova(HOConductancemodel, type = 2, test.statistic = "F")
anova_Conductance
```

```{r HOConductance Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOConductancemodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOConductancemodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOConductance Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOConductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOConductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_Conductance %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO Conductance"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOConductance Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO Conductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, Conductance)

```

### H.murinum - EFICIENCIA DEL FOTOSISTEMA II

```{r HOPhiPS2 Model, include=FALSE}
#filtramos las filas con datos de nº de PhiPS2es
HOdata.PhiPS2 <- subset(HOdata, !is.na(PhiPS2))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOPhiPS2model <- lm(sqrt(PhiPS2) ~ trat + clip + trat:clip, data = HOdata.PhiPS2, na.action = na.fail)

sample_size <- nrow(HOdata.PhiPS2)
# Extract the formula from the model
model_formula <- formula(HOPhiPS2model)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOPhiPS2: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOPhiPS2model)
plot(residuals)
```

```{r SUMMARY OF HOPhiPS2 MODEL, include=FALSE}
summary <- summary(HOPhiPS2model)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOPhiPS2 MODEL, include=FALSE}
anova_PhiPS2 <- Anova(HOPhiPS2model, type = 2, test.statistic = "F")
anova_PhiPS2
```

```{r HOPhiPS2 Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOPhiPS2model, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOPhiPS2model, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOPhiPS2 Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOPhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOPhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_PhiPS2 %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO PhiPS2"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOPhiPS2 Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO PhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, PhiPS2)

```

### H.murinum - FENOLOGÍA DE FLORACIÓN

```{r HOdias_flor Model, include=FALSE}
#filtramos las filas con datos de nº de dias_flores
HOdata.dias_flor <- subset(HOdata, !is.na(dias_flor))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOdias_flormodel <- lm(sqrt(dias_flor) ~ trat + clip + trat:clip, data = HOdata.dias_flor, na.action = na.fail)

sample_size <- nrow(HOdata.dias_flor)
sample_size
# Extract the formula from the model
model_formula <- formula(HOdias_flormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOdias_flor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOdias_flormodel)
plot(residuals)
```

```{r SUMMARY OF HOdias_flor MODEL, include=FALSE}
summary <- summary(HOdias_flormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOdias_flor MODEL, include=FALSE}
anova_dias_flor <- Anova(HOdias_flormodel, type = 2, test.statistic = "F")
anova_dias_flor
```

```{r HOdias_flor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOdias_flormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOdias_flormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOdias_flor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOdias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOdias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_flor %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO dias_flor"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOdias_flor Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO dias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, dias_flor)

```

### H.murinum - FENOLOGÍA DE FRUCTIFICACÓN

```{r HOdias_fruto Model, include=FALSE}
#filtramos las filas con datos de nº de dias_frutoes
HOdata.dias_fruto <- subset(HOdata, !is.na(dias_fruto))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOdias_frutomodel <- lm(sqrt(dias_fruto) ~ trat + clip + trat:clip, data = HOdata.dias_fruto, na.action = na.fail)

sample_size <- nrow(HOdata.dias_fruto)
sample_size
# Extract the formula from the model
model_formula <- formula(HOdias_frutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOdias_fruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOdias_frutomodel)
plot(residuals)
```

```{r SUMMARY OF HOdias_fruto MODEL, include=FALSE}
summary <- summary(HOdias_frutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOdias_fruto MODEL, include=FALSE}
anova_dias_fruto <- Anova(HOdias_frutomodel, type = 2, test.statistic = "F")
anova_dias_fruto
```

```{r HOdias_fruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOdias_frutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOdias_frutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOdias_fruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOdias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOdias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_fruto %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO dias_fruto"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOdias_fruto Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO dias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, dias_fruto)


```

### H.murinum - PERIODO DE FLORACIÓN

```{r HOperiodo_flor Model, include=FALSE}
#Creamos la variable periodo_flor
HOdata$periodo_flor <- HOdata$dias_fin_flor - HOdata$dias_flor
#filtramos las filas con datos de nº de periodo_flores
HOdata.periodo_flor <- subset(HOdata, !is.na(periodo_flor))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOperiodo_flormodel <- lm(sqrt(periodo_flor) ~ trat + clip + trat:clip, data = HOdata.periodo_flor, na.action = na.fail)#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOperiodo_flormodel <- lm(sqrt(periodo_flor) ~ trat + clip + trat:clip, data = HOdata.periodo_flor, na.action = na.fail)

sample_size <- nrow(HOdata.periodo_flor)
sample_size
# Extract the formula from the model
model_formula <- formula(HOperiodo_flormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOperiodo_flor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOperiodo_flormodel)
plot(residuals)
```

```{r SUMMARY OF HOperiodo_flor MODEL, include=FALSE}
summary <- summary(HOperiodo_flormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOperiodo_flor MODEL, include=FALSE}
# anova_periodo_flor <- Anova(HOperiodo_flormodel, type = 2, test.statistic = "F")
# anova_periodo_flor
```

```{r HOperiodo_flor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOperiodo_flormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOperiodo_flormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOperiodo_flor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOperiodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOperiodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# # Convert the ANOVA results to a data frame and create a styled table
# 
# anova_periodo_flor %>%
#   as.data.frame() %>%
#   rownames_to_column("Predictor") %>%
#   mutate(
#     Significance = case_when(
#       `Pr(>F)` < 0.001 ~ "***",
#       `Pr(>F)` < 0.01 ~ "**",
#       `Pr(>F)` < 0.05 ~ "*",
#       `Pr(>F)` < 0.1 ~ "·",
#       TRUE ~ ""  # No asterisk for p > 0.05
#     ),
#     Predictor_with_significance = paste(Predictor, Significance, sep = " ")
#   ) %>%
#   select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
#   rename(Predictor = Predictor_with_significance) %>%  # Renames column
#   mutate(
#     # Round all numeric columns to 3 decimal points
#     across(where(is.numeric), ~ round(., 3)),
#     # Add the new column 'Response' with "Diversity" in all rows
#     Response = "HO periodo_flor"
#   ) %>%
#   select(Response, Predictor, everything()) %>%  # Moves Response to the first column
#   kable("html", caption = "ANOVA Results for HOperiodo_flor Model") %>%
#   kable_styling(
#     bootstrap_options = c("striped", "hover", "condensed"),
#     full_width = FALSE
#   ) %>%
#   column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
#   column_spec(2, width = "10em")  # Adjust width of Predictor column
# 

```

```{r PLOTTING HO periodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, periodo_flor)

```

### H.murinum - PERIODO DE FRUCTIFICACIÓN

```{r HOperiodo_fruto Model, include=FALSE}
#Creamos la variable periodo_fruto
HOdata$periodo_fruto <- HOdata$dias_fin_fruto - HOdata$dias_fruto
 #filtramos las filas con datos de nº de periodo_frutoes 

 HOdata.periodo_fruto <- subset(HOdata, !is.na(periodo_fruto)) 

 #probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos 

 HOperiodo_frutomodel <- lm(sqrt(periodo_fruto) ~ trat + clip + trat:clip, data = HOdata.periodo_fruto, na.action = na.fail) 

 sample_size <- nrow(HOdata.periodo_fruto) 

 # Extract the formula from the model 

 model_formula <- formula(HOperiodo_frutomodel) 

 # Convert formula to character and clean up 

 model_formula_clean <- deparse(model_formula) 

```

**`r model_formula_clean`** 

n = **`r sample_size`**

```{r DHARMA HOperiodo_fruto: checking residuals, echo=FALSE, fig.show='hide'}

 residuals <- simulateResiduals(fittedModel = HOperiodo_frutomodel) 

 plot(residuals) 

```

```{r SUMMARY OF HOperiodo_fruto MODEL, include=FALSE}

 summary <- summary(HOperiodo_frutomodel) 

 rsq <- summary$adj.r.squared 

 rsq 

```

R² = **`r rsq`**

```{r ANOVA OF HOperiodo_fruto MODEL, include=FALSE}

 anova_periodo_fruto <- Anova(HOperiodo_frutomodel, type = 2, test.statistic = "F") 

 anova_periodo_fruto 

```

```{r HOperiodo_fruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}

 # This will compare treatment levels within each level of grazer 

 posthoc_trat <- emmeans(HOperiodo_frutomodel, pairwise ~ trat | clip, adjust = "tukey") 

 print(posthoc_trat) 

 # This will compare grazer levels within each treatment 

 posthoc_clip <- emmeans(HOperiodo_frutomodel, pairwise ~ clip | trat, adjust = "tukey") 

 print(posthoc_clip) 

 # Visualizing results 

 # Plot treatment differences within each grazer 

 plot(posthoc_trat$emmeans)   

 # Plot grazer differences within each treatment 

 plot(posthoc_clip$emmeans) 


```

##### [HOperiodo_fruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOperiodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}

 kable(as.data.frame(posthoc_clip$contrasts)) 

 kable(as.data.frame(posthoc_trat$contrasts)) 


```

```{r ANOVA HOperiodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}

 # Convert the ANOVA results to a data frame and create a styled table 

 anova_periodo_fruto %>% 

   as.data.frame() %>% 

   rownames_to_column("Predictor") %>% 

   mutate( 

     Significance = case_when( 

       `Pr(>F)` < 0.001 ~ "***", 

       `Pr(>F)` < 0.01 ~ "**", 

       `Pr(>F)` < 0.05 ~ "*", 

       `Pr(>F)` < 0.1 ~ "·", 

       TRUE ~ ""  # No asterisk for p > 0.05 

     ), 

     Predictor_with_significance = paste(Predictor, Significance, sep = " ") 

   ) %>% 

   select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns 

   rename(Predictor = Predictor_with_significance) %>%  # Renames column 

   mutate( 

     # Round all numeric columns to 3 decimal points 

     across(where(is.numeric), ~ round(., 3)), 

     # Add the new column 'Response' with "Diversity" in all rows 

     Response = "HO periodo_fruto" 

   ) %>% 

   select(Response, Predictor, everything()) %>%  # Moves Response to the first column 

   kable("html", caption = "ANOVA Results for HOperiodo_fruto Model") %>% 

   kable_styling( 

     bootstrap_options = c("striped", "hover", "condensed"),  

     full_width = FALSE 

   ) %>% 

   column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response 

   column_spec(2, width = "10em")  # Adjust width of Predictor column 


```

```{r PLOTTING HO periodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}

 plot_HO_variable(HOdata, periodo_fruto)
```

### H.murinum - ESPERANZA DE VIDA

```{r HOdias_muerte Model, include=FALSE}
#filtramos las filas con datos de nº de dias_muertees
HOdata.dias_muerte <- subset(HOdata, !is.na(dias_muerte))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOdias_muertemodel <- lm(sqrt(dias_muerte) ~ trat + clip + trat:clip, data = HOdata.dias_muerte, na.action = na.fail)

sample_size <- nrow(HOdata.dias_muerte)
# Extract the formula from the model
model_formula <- formula(HOdias_muertemodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA HOdias_muerte: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOdias_muertemodel)
plot(residuals)
```

```{r SUMMARY OF HOdias_muerte MODEL, include=FALSE}
summary <- summary(HOdias_muertemodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOdias_muerte MODEL, include=FALSE}
anova_dias_muerte <- Anova(HOdias_muertemodel, type = 2, test.statistic = "F")
anova_dias_muerte
```

```{r HOdias_muerte Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOdias_muertemodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOdias_muertemodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOdias_muerte Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOdias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOdias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_muerte %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO dias_muerte"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOdias_muerte Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO dias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata, dias_muerte)

```

### H.murinum - FENOLES

```{r HOfenoles Model, include=FALSE}
#filtramos las filas con datos de nº de fenoleses
HOdata.fenoles <- subset(HOdata, !is.na(fenoles))
plot(density(HOdata.fenoles$fenoles))
HOdata.fenoles$fenoles
# Find the row with the highest and lowest fenoles value (OUTLIERS)
max_row <- HOdata.fenoles[which.max(HOdata.fenoles$fenoles), ]
min_row <- HOdata.fenoles[which.min(HOdata.fenoles$fenoles), ]


#REMOVING AN EXTREME VALUE OF fenoles
HOdata.fenoles <- HOdata.fenoles[HOdata.fenoles$id!= 334, ]
HOdata.fenoles <- HOdata.fenoles[HOdata.fenoles$id!= 345, ]


#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
HOfenolesmodel <- lm(fenoles ~ trat + clip + trat:clip, data = HOdata.fenoles, na.action = na.fail)

sample_size <- nrow(HOdata.fenoles)
# Extract the formula from the model
model_formula <- formula(HOfenolesmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`** he quitado dos outliers que supongo se deben a algún error (¿3 y 170?)

```{r DHARMA HOfenoles: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = HOfenolesmodel)
plot(residuals)
```

```{r SUMMARY OF HOfenoles MODEL, include=FALSE}
summary <- summary(HOfenolesmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF HOfenoles MODEL, include=FALSE}
anova_fenoles <- Anova(HOfenolesmodel, type = 2, test.statistic = "F")
anova_fenoles
```

```{r HOfenoles Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(HOfenolesmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(HOfenolesmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [HOfenoles Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc HOfenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA HOfenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_fenoles %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "HO fenoles"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for HOfenoles Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING HO fenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_HO_variable(HOdata.fenoles, fenoles)
```
