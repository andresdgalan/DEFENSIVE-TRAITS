---
title: "DEFENSIVE TRAITS A.barbata SIBECOL 2025"
author: "Andrés Delgado Galán"
date: "2025-05-09"
output:
  html_document: default
  pdf_document: default
---

```{r LOADING DATA AND PACKAGES, include=FALSE}

library(dplyr)
library(DHARMa)
library(ggplot2)
library(ggeffects)
library(cowplot)
library(kableExtra)
library(tibble)
library(knitr)
library(emmeans)
library(car)
library(scales)

data <- read.table("rawdata/datos_sibecol_2025.csv", header = TRUE, sep = ";")
datamother <- read.table("rawdata/seedmother.csv", header = TRUE, sep = ";")
```

```{r PRE-ANALYSIS Data PREPARATION, include=FALSE}
#hacemos una matriz para para la especie AV
AVdata <- data |> filter(sp == "AV")
```

```{r PREPARING A PLOTTING FUNCTION, include=FALSE}
# Define color palettes
custom_colors <- c("Grazed" = "#FF10F0", "Ungrazed" = "#006400")
lighter_colors <- c("Grazed" = alpha("#FF10F0", 0.3), "Ungrazed" = alpha("#006400", 0.3))

# Named vectors for relabeling
trat_labels <- c("gra" = "Grazed", "ex" = "Ungrazed")
clip_labels <- c("yes" = "Damaged", "no" = "Undamaged")

# Prepare your data once
AVdata <- AVdata %>%
  mutate(
    trat_label = factor(trat_labels[as.character(trat)], levels = c("Ungrazed", "Grazed")),
    clip_label = factor(clip_labels[as.character(clip)], levels = c("Undamaged", "Damaged"))
  )

# Define a reusable plotting function
plot_AV_variable <- function(data, response_var) {
  ggplot(data, aes(x = trat_label, y = {{ response_var }})) +
    
    # Boxplot
    geom_boxplot(
      aes(color = trat_label),
      fill = NA,
      size = 1,
      width = 0.5
    ) +
    
    # Violin for Undamaged (filled)
    geom_violin(
      data = filter(data, clip_label == "Undamaged"),
      aes(
        fill = trat_label,
        group = interaction(trat_label, clip_label),
        linetype = clip_label
      ),
      color = NA,
      alpha = 0.2,
      width = 0.5,
      scale = "area"
    ) +
    
    # Violin for Damaged (outline)
    geom_violin(
      data = filter(data, clip_label == "Damaged"),
      aes(
        color = trat_label,
        group = interaction(trat_label, clip_label),
        linetype = clip_label
      ),
      fill = NA,
      alpha = 0.2,
      size = 0.8,
      width = 0.5,
      scale = "area"
    ) +
    
    scale_color_manual(values = custom_colors, guide = "none") +
    scale_fill_manual(values = custom_colors, guide = "none") +
    scale_linetype_manual(
      values = c("Undamaged" = "solid", "Damaged" = "dashed"),
      name = NULL
    ) +
    
    labs(
      x = "Maternal Environment",
      y = as_label(enquo(response_var)),
      linetype = "Herbivory Simulation"
    ) +
    theme_minimal() +
    theme(
      legend.title = element_blank(),
      legend.position = "right"
    )
}

```


### A.barbata - PRODUCCIÓN DE FLORES

```{r AVflor Model, include=FALSE}
#filtramos las filas con datos de nº de flores
AVdata.flor <- subset(AVdata, !is.na(flor))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVflormodel <- lm(sqrt(flor) ~ trat + clip + trat:clip, data = AVdata.flor, na.action = na.fail)

sample_size <- nrow(AVdata.flor)
# Extract the formula from the model
model_formula <- formula(AVflormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVflor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVflormodel)
plot(residuals)
```

```{r SUMMARY OF AVflor MODEL, include=FALSE}
summary <- summary(AVflormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVflor MODEL, include=FALSE}
anova_flor <- Anova(AVflormodel, type = 2, test.statistic = "F")
anova_flor
```

```{r AVflor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVflormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVflormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVflor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVflor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVflor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_flor %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV flor"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVflor Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, flor)

```

### A.barbata - PRODUCCIÓN DE FRUTOS

```{r AVfruto Model, include=FALSE}
#filtramos las filas con datos de nº de frutoes
AVdata.fruto <- subset(AVdata, !is.na(fruto))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVfrutomodel <- lm(sqrt(fruto) ~ trat + clip + trat:clip, data = AVdata.fruto, na.action = na.fail)

sample_size <- nrow(AVdata.fruto)
# Extract the formula from the model
model_formula <- formula(AVfrutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVfruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVfrutomodel)
plot(residuals)
```

```{r SUMMARY OF AVfruto MODEL, include=FALSE}
summary <- summary(AVfrutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVfruto MODEL, include=FALSE}
anova_fruto <- Anova(AVfrutomodel, type = 2, test.statistic = "F")
anova_fruto
```

```{r AVfruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVfrutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVfrutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVfruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_fruto %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV fruto"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVfruto Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, fruto)

```

### A.barbata - PRODUCCIÓN DE HOJAS

```{r AVhojas Model, include=FALSE}
#filtramos las filas con datos de nº de hojases
AVdata.hojas <- subset(AVdata, !is.na(hojas))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVhojasmodel <- lm(sqrt(hojas) ~ trat + clip + trat:clip, data = AVdata.hojas, na.action = na.fail)

sample_size <- nrow(AVdata.hojas)
# Extract the formula from the model
model_formula <- formula(AVhojasmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVhojas: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVhojasmodel)
plot(residuals)
```

```{r SUMMARY OF AVhojas MODEL, include=FALSE}
summary <- summary(AVhojasmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVhojas MODEL, include=FALSE}
anova_hojas <- Anova(AVhojasmodel, type = 2, test.statistic = "F")
anova_hojas
```

```{r AVhojas Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVhojasmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVhojasmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVhojas Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVhojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVhojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_hojas %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV hojas"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVhojas Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV hojas, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, hojas)
```

### A.barbata - ALTURA MÁXIMA

```{r AValtura Model, include=FALSE}
#filtramos las filas con datos de nº de alturaes
AVdata.altura <- subset(AVdata, !is.na(altura))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AValturamodel <- lm(sqrt(altura) ~ trat + clip + trat:clip, data = AVdata.altura, na.action = na.fail)

sample_size <- nrow(AVdata.altura)
# Extract the formula from the model
model_formula <- formula(AValturamodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AValtura: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AValturamodel)
plot(residuals)
```

```{r SUMMARY OF AValtura MODEL, include=FALSE}
summary <- summary(AValturamodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AValtura MODEL, include=FALSE}
anova_altura <- Anova(AValturamodel, type = 2, test.statistic = "F")
anova_altura
```

```{r AValtura Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AValturamodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AValturamodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AValtura Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AValtura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AValtura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_altura %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV altura"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AValtura Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV altura, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, altura)


```

### A.barbata - SEMILLAS/FRUTO

```{r AVseedfruto Model, include=FALSE}
#filtramos las filas con datos de nº de seedfrutoes
AVdata.seedfruto <- subset(AVdata, !is.na(seedfruto))
AVdata.seedfruto$seedfruto

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVseedfrutomodel <- lm(sqrt(seedfruto) ~ trat + clip + trat:clip, data = AVdata.seedfruto, na.action = na.fail)

sample_size <- nrow(AVdata.seedfruto)
# Extract the formula from the model
model_formula <- formula(AVseedfrutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVseedfruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVseedfrutomodel)
plot(residuals)
```

```{r SUMMARY OF AVseedfruto MODEL, include=FALSE}
summary <- summary(AVseedfrutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVseedfruto MODEL, include=FALSE}
# anova_seedfruto <- Anova(AVseedfrutomodel, type = 2, test.statistic = "F")
# anova_seedfruto
```

```{r AVseedfruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVseedfrutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVseedfrutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVseedfruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVseedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVseedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# # Convert the ANOVA results to a data frame and create a styled table
# 
# anova_seedfruto %>%
#   as.data.frame() %>%
#   rownames_to_column("Predictor") %>%
#   mutate(
#     Significance = case_when(
#       `Pr(>F)` < 0.001 ~ "***",
#       `Pr(>F)` < 0.01 ~ "**",
#       `Pr(>F)` < 0.05 ~ "*",
#       `Pr(>F)` < 0.1 ~ "·",
#       TRUE ~ ""  # No asterisk for p > 0.05
#     ),
#     Predictor_with_significance = paste(Predictor, Significance, sep = " ")
#   ) %>%
#   select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
#   rename(Predictor = Predictor_with_significance) %>%  # Renames column
#   mutate(
#     # Round all numeric columns to 3 decimal points
#     across(where(is.numeric), ~ round(., 3)),
#     # Add the new column 'Response' with "Diversity" in all rows
#     Response = "AV seedfruto"
#   ) %>%
#   select(Response, Predictor, everything()) %>%  # Moves Response to the first column
#   kable("html", caption = "ANOVA Results for AVseedfruto Model") %>%
#   kable_styling(
#     bootstrap_options = c("striped", "hover", "condensed"), 
#     full_width = FALSE
#   ) %>%
#   column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
#   column_spec(2, width = "10em")  # Adjust width of Predictor column
# 

```

```{r PLOTTING AV seedfruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, seedfruto)

```

### A.barbata - PRODUCCIÓN DE SEMILLAS

```{r AVseedtotal Model, include=FALSE}
#filtramos las filas con datos de nº de seedtotales
AVdata.seedtotal <- subset(AVdata, !is.na(seedtotal))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVseedtotalmodel <- lm(sqrt(seedtotal) ~ trat + clip + trat:clip, data = AVdata.seedtotal, na.action = na.fail)

sample_size <- nrow(AVdata.seedtotal)
# Extract the formula from the model
model_formula <- formula(AVseedtotalmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVseedtotal: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVseedtotalmodel)
plot(residuals)
```

```{r SUMMARY OF AVseedtotal MODEL, include=FALSE}
summary <- summary(AVseedtotalmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVseedtotal MODEL, include=FALSE}
anova_seedtotal <- Anova(AVseedtotalmodel, type = 2, test.statistic = "F")
anova_seedtotal
```

```{r AVseedtotal Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVseedtotalmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVseedtotalmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVseedtotal Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVseedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVseedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_seedtotal %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV seedtotal"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVseedtotal Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV seedtotal, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, seedtotal)

```

### A.barbata - PESO MEDIO DE LAS SEMILLAS

```{r AVmassseed Model, include=FALSE}
#filtramos las filas con datos de nº de massseedes
AVdata.massseed <- subset(AVdata, !is.na(massseed))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVmassseedmodel <- lm(sqrt(massseed) ~ trat + clip + trat:clip, data = AVdata.massseed, na.action = na.fail)

sample_size <- nrow(AVdata.massseed)
# Extract the formula from the model
model_formula <- formula(AVmassseedmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVmassseed: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVmassseedmodel)
plot(residuals)
```

```{r SUMMARY OF AVmassseed MODEL, include=FALSE}
summary <- summary(AVmassseedmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVmassseed MODEL, include=FALSE}
anova_massseed <- Anova(AVmassseedmodel, type = 2, test.statistic = "F")
anova_massseed
```

```{r AVmassseed Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVmassseedmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVmassseedmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVmassseed Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVmassseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVmassseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_massseed %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV massseed"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVmassseed Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV massseed, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, massseed)
```

### A.barbata - SLA

```{r AVSLA Model, include=FALSE}
#filtramos las filas con datos de nº de SLAes
AVdata.SLA <- subset(AVdata, !is.na(SLA))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVSLAmodel <- lm(sqrt(SLA) ~ trat + clip + trat:clip, data = AVdata.SLA, na.action = na.fail)

sample_size <- nrow(AVdata.SLA)
# Extract the formula from the model
model_formula <- formula(AVSLAmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVSLA: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVSLAmodel)
plot(residuals)
```

```{r SUMMARY OF AVSLA MODEL, include=FALSE}
summary <- summary(AVSLAmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVSLA MODEL, include=FALSE}
anova_SLA <- Anova(AVSLAmodel, type = 2, test.statistic = "F")
anova_SLA
```

```{r AVSLA Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVSLAmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVSLAmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVSLA Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVSLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVSLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_SLA %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV SLA"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVSLA Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV SLA, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, SLA)

```

### A.barbata - LDMC

```{r AVLDMC Model, include=FALSE}
#filtramos las filas con datos de nº de LDMCes
AVdata.LDMC <- subset(AVdata, !is.na(LDMC))
# Find the row with the highest LDMC value (OUTLIER)
max_row <- AVdata.LDMC[which.max(AVdata.LDMC$LDMC), ]
#checking the other LDMC values in this group: 9 values with a range of 0.127 - 0.146
#suddenly one value of 0.393 which is almost 3 times higher
subset(AVdata.LDMC, trat == "gra" & clip == "yes")$LDMC
#REMOVING AN EXTREME VALUE OF LDMC. IS THIS FALSING DATA?
AVdata.LDMC <- AVdata.LDMC[AVdata.LDMC$id!= 241, ]




#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVLDMCmodel <- lm(sqrt(LDMC) ~ trat + clip + trat:clip, data = AVdata.LDMC, na.action = na.fail)

sample_size <- nrow(AVdata.LDMC)
# Extract the formula from the model
model_formula <- formula(AVLDMCmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVLDMC: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVLDMCmodel)
plot(residuals)
```

```{r SUMMARY OF AVLDMC MODEL, include=FALSE}
summary <- summary(AVLDMCmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVLDMC MODEL, include=FALSE}
anova_LDMC <- Anova(AVLDMCmodel, type = 2, test.statistic = "F")
anova_LDMC
```

```{r AVLDMC Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVLDMCmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVLDMCmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVLDMC Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVLDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVLDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_LDMC %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV LDMC"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVLDMC Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV LDMC, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata.LDMC, LDMC)
```

### A.barbata - ÁREA FOLIAR

```{r AVarea.m Model, include=FALSE}
#filtramos las filas con datos de nº de area.mes
AVdata.area.m <- subset(AVdata, !is.na(area.m))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVarea.mmodel <- lm(sqrt(area.m) ~ trat + clip + trat:clip, data = AVdata.area.m, na.action = na.fail)

sample_size <- nrow(AVdata.area.m)
# Extract the formula from the model
model_formula <- formula(AVarea.mmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVarea.m: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVarea.mmodel)
plot(residuals)
```

```{r SUMMARY OF AVarea.m MODEL, include=FALSE}
summary <- summary(AVarea.mmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVarea.m MODEL, include=FALSE}
anova_area.m <- Anova(AVarea.mmodel, type = 2, test.statistic = "F")
anova_area.m
```

```{r AVarea.m Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVarea.mmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVarea.mmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVarea.m Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVarea.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVarea.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_area.m %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV area.m"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVarea.m Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV area.m, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, area.m)
```

### A.barbata - TASA FOTOSINTÉTICA

```{r AVPhotosyn Model, include=FALSE}
#filtramos las filas con datos de nº de Photosynes
AVdata.Photosyn <- subset(AVdata, !is.na(Photosyn))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVPhotosynmodel <- lm(sqrt(Photosyn) ~ trat + clip + trat:clip, data = AVdata.Photosyn, na.action = na.fail)

sample_size <- nrow(AVdata.Photosyn)
# Extract the formula from the model
model_formula <- formula(AVPhotosynmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVPhotosyn: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVPhotosynmodel)
plot(residuals)
```

```{r SUMMARY OF AVPhotosyn MODEL, include=FALSE}
summary <- summary(AVPhotosynmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVPhotosyn MODEL, include=FALSE}
anova_Photosyn <- Anova(AVPhotosynmodel, type = 2, test.statistic = "F")
anova_Photosyn
```

```{r AVPhotosyn Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVPhotosynmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVPhotosynmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVPhotosyn Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVPhotosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVPhotosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_Photosyn %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV Photosyn"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVPhotosyn Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV Photosyn, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, Photosyn)

```

### A.barbata - CONDUCTANCIA ESTOMÁTICA

```{r AVConductance Model, include=FALSE}
#filtramos las filas con datos de nº de Conductancees
AVdata.Conductance <- subset(AVdata, !is.na(Conductance))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVConductancemodel <- lm(sqrt(Conductance) ~ trat + clip + trat:clip, data = AVdata.Conductance, na.action = na.fail)

sample_size <- nrow(AVdata.Conductance)
# Extract the formula from the model
model_formula <- formula(AVConductancemodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVConductance: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVConductancemodel)
plot(residuals)
```

```{r SUMMARY OF AVConductance MODEL, include=FALSE}
summary <- summary(AVConductancemodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVConductance MODEL, include=FALSE}
anova_Conductance <- Anova(AVConductancemodel, type = 2, test.statistic = "F")
anova_Conductance
```

```{r AVConductance Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVConductancemodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVConductancemodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVConductance Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVConductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVConductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_Conductance %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV Conductance"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVConductance Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV Conductance, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, Conductance)

```

### A.barbata - EFICIENCIA DEL FOTOSISTEMA II

```{r AVPhiPS2 Model, include=FALSE}
#filtramos las filas con datos de nº de PhiPS2es
AVdata.PhiPS2 <- subset(AVdata, !is.na(PhiPS2))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVPhiPS2model <- lm(sqrt(PhiPS2) ~ trat + clip + trat:clip, data = AVdata.PhiPS2, na.action = na.fail)

sample_size <- nrow(AVdata.PhiPS2)
# Extract the formula from the model
model_formula <- formula(AVPhiPS2model)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVPhiPS2: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVPhiPS2model)
plot(residuals)
```

```{r SUMMARY OF AVPhiPS2 MODEL, include=FALSE}
summary <- summary(AVPhiPS2model)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVPhiPS2 MODEL, include=FALSE}
anova_PhiPS2 <- Anova(AVPhiPS2model, type = 2, test.statistic = "F")
anova_PhiPS2
```

```{r AVPhiPS2 Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVPhiPS2model, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVPhiPS2model, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVPhiPS2 Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVPhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVPhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_PhiPS2 %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV PhiPS2"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVPhiPS2 Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV PhiPS2, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, PhiPS2)

```

### A.barbata - FENOLOGÍA DE FLORACIÓN

```{r AVdias_flor Model, include=FALSE}
#filtramos las filas con datos de nº de dias_flores
AVdata.dias_flor <- subset(AVdata, !is.na(dias_flor))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVdias_flormodel <- lm(sqrt(dias_flor) ~ trat + clip + trat:clip, data = AVdata.dias_flor, na.action = na.fail)

sample_size <- nrow(AVdata.dias_flor)
sample_size
# Extract the formula from the model
model_formula <- formula(AVdias_flormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVdias_flor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVdias_flormodel)
plot(residuals)
```

```{r SUMMARY OF AVdias_flor MODEL, include=FALSE}
summary <- summary(AVdias_flormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVdias_flor MODEL, include=FALSE}
anova_dias_flor <- Anova(AVdias_flormodel, type = 2, test.statistic = "F")
anova_dias_flor
```

```{r AVdias_flor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVdias_flormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVdias_flormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVdias_flor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVdias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVdias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_flor %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV dias_flor"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVdias_flor Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV dias_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, dias_flor)

```

### A.barbata - FENOLOGÍA DE FRUCTIFICACÓN

```{r AVdias_fruto Model, include=FALSE}
#filtramos las filas con datos de nº de dias_frutoes
AVdata.dias_fruto <- subset(AVdata, !is.na(dias_fruto))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVdias_frutomodel <- lm(sqrt(dias_fruto) ~ trat + clip + trat:clip, data = AVdata.dias_fruto, na.action = na.fail)

sample_size <- nrow(AVdata.dias_fruto)
sample_size
# Extract the formula from the model
model_formula <- formula(AVdias_frutomodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVdias_fruto: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVdias_frutomodel)
plot(residuals)
```

```{r SUMMARY OF AVdias_fruto MODEL, include=FALSE}
summary <- summary(AVdias_frutomodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVdias_fruto MODEL, include=FALSE}
anova_dias_fruto <- Anova(AVdias_frutomodel, type = 2, test.statistic = "F")
anova_dias_fruto
```

```{r AVdias_fruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVdias_frutomodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVdias_frutomodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVdias_fruto Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVdias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVdias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_fruto %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV dias_fruto"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVdias_fruto Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV dias_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, dias_fruto)


```

### A.barbata - PERIODO DE FLORACIÓN

```{r AVperiodo_flor Model, include=FALSE}
#Creamos la variable periodo_flor
AVdata$periodo_flor <- AVdata$dias_fin_flor - AVdata$dias_flor
#filtramos las filas con datos de nº de periodo_flores
AVdata.periodo_flor <- subset(AVdata, !is.na(periodo_flor))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVperiodo_flormodel <- lm(sqrt(periodo_flor) ~ trat + clip + trat:clip, data = AVdata.periodo_flor, na.action = na.fail)#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVperiodo_flormodel <- lm(sqrt(periodo_flor) ~ trat + clip + trat:clip, data = AVdata.periodo_flor, na.action = na.fail)

sample_size <- nrow(AVdata.periodo_flor)
sample_size
# Extract the formula from the model
model_formula <- formula(AVperiodo_flormodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVperiodo_flor: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVperiodo_flormodel)
plot(residuals)
```

```{r SUMMARY OF AVperiodo_flor MODEL, include=FALSE}
summary <- summary(AVperiodo_flormodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVperiodo_flor MODEL, include=FALSE}
anova_periodo_flor <- Anova(AVperiodo_flormodel, type = 2, test.statistic = "F")
anova_periodo_flor
```

```{r AVperiodo_flor Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVperiodo_flormodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVperiodo_flormodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVperiodo_flor Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVperiodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVperiodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_periodo_flor %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV periodo_flor"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVperiodo_flor Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV periodo_flor, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, periodo_flor)

```

### A.barbata - PERIODO DE FRUCTIFICACIÓN

```{r AVperiodo_fruto Model, include=FALSE} 
#Creamos la variable periodo_fruto
AVdata$periodo_fruto <- AVdata$dias_fin_fruto - AVdata$dias_fruto
 #filtramos las filas con datos de nº de periodo_frutoes 

 AVdata.periodo_fruto <- subset(AVdata, !is.na(periodo_fruto)) 

 #probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos 

 AVperiodo_frutomodel <- lm(sqrt(periodo_fruto) ~ trat + clip + trat:clip, data = AVdata.periodo_fruto, na.action = na.fail) 

 sample_size <- nrow(AVdata.periodo_fruto) 

 # Extract the formula from the model 

 model_formula <- formula(AVperiodo_frutomodel) 

 # Convert formula to character and clean up 

 model_formula_clean <- deparse(model_formula) 

```


 **`r model_formula_clean`**\ 

 n = **`r sample_size`** 


```{r DHARMA AVperiodo_fruto: checking residuals, echo=FALSE, fig.show='hide'} 

 residuals <- simulateResiduals(fittedModel = AVperiodo_frutomodel) 

 plot(residuals) 

```

```{r SUMMARY OF AVperiodo_fruto MODEL, include=FALSE} 

 summary <- summary(AVperiodo_frutomodel) 

 rsq <- summary$adj.r.squared 

 rsq 

```

 R² = **`r rsq`** 

```{r ANOVA OF AVperiodo_fruto MODEL, include=FALSE} 

 anova_periodo_fruto <- Anova(AVperiodo_frutomodel, type = 2, test.statistic = "F") 

 anova_periodo_fruto 

```

```{r AVperiodo_fruto Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE} 

 # This will compare treatment levels within each level of grazer 

 posthoc_trat <- emmeans(AVperiodo_frutomodel, pairwise ~ trat | clip, adjust = "tukey") 

 print(posthoc_trat) 

 # This will compare grazer levels within each treatment 

 posthoc_clip <- emmeans(AVperiodo_frutomodel, pairwise ~ clip | trat, adjust = "tukey") 

 print(posthoc_clip) 

 # Visualizing results 

 # Plot treatment differences within each grazer 

 plot(posthoc_trat$emmeans)   

 # Plot grazer differences within each treatment 

 plot(posthoc_clip$emmeans) 


```


 ##### [AVperiodo_fruto Post-hoc Comparisons with Tukeys HSD]{.underline} 

```{r Post-hoc AVperiodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE} 

 kable(as.data.frame(posthoc_clip$contrasts)) 

 kable(as.data.frame(posthoc_trat$contrasts)) 


```

```{r ANOVA AVperiodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE} 

 # Convert the ANOVA results to a data frame and create a styled table 

 anova_periodo_fruto %>% 

   as.data.frame() %>% 

   rownames_to_column("Predictor") %>% 

   mutate( 

     Significance = case_when( 

       `Pr(>F)` < 0.001 ~ "***", 

       `Pr(>F)` < 0.01 ~ "**", 

       `Pr(>F)` < 0.05 ~ "*", 

       `Pr(>F)` < 0.1 ~ "·", 

       TRUE ~ ""  # No asterisk for p > 0.05 

     ), 

     Predictor_with_significance = paste(Predictor, Significance, sep = " ") 

   ) %>% 

   select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns 

   rename(Predictor = Predictor_with_significance) %>%  # Renames column 

   mutate( 

     # Round all numeric columns to 3 decimal points 

     across(where(is.numeric), ~ round(., 3)), 

     # Add the new column 'Response' with "Diversity" in all rows 

     Response = "AV periodo_fruto" 

   ) %>% 

   select(Response, Predictor, everything()) %>%  # Moves Response to the first column 

   kable("html", caption = "ANOVA Results for AVperiodo_fruto Model") %>% 

   kable_styling( 

     bootstrap_options = c("striped", "hover", "condensed"),  

     full_width = FALSE 

   ) %>% 

   column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response 

   column_spec(2, width = "10em")  # Adjust width of Predictor column 


```

```{r PLOTTING AV periodo_fruto, echo=FALSE, results='hold', warning=FALSE, message=FALSE} 

 plot_AV_variable(AVdata, periodo_fruto)
```
 

### A.barbata - ESPERANZA DE VIDA

```{r AVdias_muerte Model, include=FALSE}
#filtramos las filas con datos de nº de dias_muertees
AVdata.dias_muerte <- subset(AVdata, !is.na(dias_muerte))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVdias_muertemodel <- lm(sqrt(dias_muerte) ~ trat + clip + trat:clip, data = AVdata.dias_muerte, na.action = na.fail)

sample_size <- nrow(AVdata.dias_muerte)
# Extract the formula from the model
model_formula <- formula(AVdias_muertemodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVdias_muerte: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVdias_muertemodel)
plot(residuals)
```

```{r SUMMARY OF AVdias_muerte MODEL, include=FALSE}
summary <- summary(AVdias_muertemodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVdias_muerte MODEL, include=FALSE}
anova_dias_muerte <- Anova(AVdias_muertemodel, type = 2, test.statistic = "F")
anova_dias_muerte
```

```{r AVdias_muerte Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVdias_muertemodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVdias_muertemodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVdias_muerte Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVdias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVdias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_dias_muerte %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV dias_muerte"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVdias_muerte Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV dias_muerte, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, dias_muerte)

```

### A.barbata - FENOLES

```{r AVfenoles Model, include=FALSE}
#filtramos las filas con datos de nº de fenoleses
AVdata.fenoles <- subset(AVdata, !is.na(fenoles))

#probamos el modelo con distintas transformaciones y familias de glm para ver cuál es el que mejor se ajusta a los datos
AVfenolesmodel <- lm(sqrt(fenoles) ~ trat + clip + trat:clip, data = AVdata.fenoles, na.action = na.fail)

sample_size <- nrow(AVdata.fenoles)
# Extract the formula from the model
model_formula <- formula(AVfenolesmodel)
# Convert formula to character and clean up
model_formula_clean <- deparse(model_formula)
```

**`r model_formula_clean`**\
n = **`r sample_size`**

```{r DHARMA AVfenoles: checking residuals, echo=FALSE, fig.show='hide'}
residuals <- simulateResiduals(fittedModel = AVfenolesmodel)
plot(residuals)
```

```{r SUMMARY OF AVfenoles MODEL, include=FALSE}
summary <- summary(AVfenolesmodel)
rsq <- summary$adj.r.squared
rsq
```

R² = **`r rsq`**

```{r ANOVA OF AVfenoles MODEL, include=FALSE}
anova_fenoles <- Anova(AVfenolesmodel, type = 2, test.statistic = "F")
anova_fenoles
```

```{r AVfenoles Post-hoc Comparisons with Tukeys HSD, echo=FALSE, include=FALSE}
# This will compare treatment levels within each level of grazer
posthoc_trat <- emmeans(AVfenolesmodel, pairwise ~ trat | clip, adjust = "tukey")
print(posthoc_trat)

# This will compare grazer levels within each treatment
posthoc_clip <- emmeans(AVfenolesmodel, pairwise ~ clip | trat, adjust = "tukey")
print(posthoc_clip)

# Visualizing results

# Plot treatment differences within each grazer
plot(posthoc_trat$emmeans)  

# Plot grazer differences within each treatment
plot(posthoc_clip$emmeans)

```

##### [AVfenoles Post-hoc Comparisons with Tukeys HSD]{.underline}

```{r Post-hoc AVfenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
kable(as.data.frame(posthoc_clip$contrasts))

kable(as.data.frame(posthoc_trat$contrasts))

```

```{r ANOVA AVfenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
# Convert the ANOVA results to a data frame and create a styled table

anova_fenoles %>%
  as.data.frame() %>%
  rownames_to_column("Predictor") %>%
  mutate(
    Significance = case_when(
      `Pr(>F)` < 0.001 ~ "***",
      `Pr(>F)` < 0.01 ~ "**",
      `Pr(>F)` < 0.05 ~ "*",
      `Pr(>F)` < 0.1 ~ "·",
      TRUE ~ ""  # No asterisk for p > 0.05
    ),
    Predictor_with_significance = paste(Predictor, Significance, sep = " ")
  ) %>%
  select(-Predictor, -Significance) %>%  # Removes Df.res and Significance columns
  rename(Predictor = Predictor_with_significance) %>%  # Renames column
  mutate(
    # Round all numeric columns to 3 decimal points
    across(where(is.numeric), ~ round(., 3)),
    # Add the new column 'Response' with "Diversity" in all rows
    Response = "AV fenoles"
  ) %>%
  select(Response, Predictor, everything()) %>%  # Moves Response to the first column
  kable("html", caption = "ANOVA Results for AVfenoles Model") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"), 
    full_width = FALSE
  ) %>%
  column_spec(1, background = "lightgray", bold = TRUE, width = "5em") %>%  # Style Response
  column_spec(2, width = "10em")  # Adjust width of Predictor column


```

```{r PLOTTING AV fenoles, echo=FALSE, results='hold', warning=FALSE, message=FALSE}
plot_AV_variable(AVdata, fenoles)
```
